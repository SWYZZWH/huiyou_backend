# 后端开发文档

Update 2020/10/11 by ZWH

利用Github Action实现自动化部署

- Github Action其实就是一个触发式的云服务器

- 由于有store，可以方便的调用其他开发者贡献的Actions（实际上每个Action就是Github上一个Repository）

- 使用[ssh deploy](https://github.com/marketplace/actions/ssh-deploy) 这个Action，可以与腾讯云服务器建立SSH链接，然后每当有了新的push时，将执行这个Action，将当前项目中的指定文件（最终生成的.jar包）上传到服务器，这样就避免了每次生成新的包以后都要手动上传

- 配置时要注意，需要在腾讯云服务器上生成SSH密钥对，将**公钥**添加到腾讯云服务器的Auth_keys，将**私钥**存到Github项目的Secrets中。

- 更进一步，通过Action，上传项目包后通过脚本自动启动服务

- 使用appleboy/ssh-action@v0.1.3 这个Action，配置几乎同上

- script的值是要运行的脚本：

  ```
  script: |
  	# kill previous service
      sudo kill -9 $(lsof -i:8080 -t)
      cd /usr/local/huiyou-backend
      java -jar demo-0.0.1-SNAPSHOT.jar &
      disown
  ```

- 一点缺陷：执行该脚本后Action无法自动结束，需要手动终止



Update 2020/10/10 by ZWH

设置服务为守护进程，避免退出SSH后自动结束进程

- SSH启动的服务实际上默认是前台进程，前台进程在退出SSH后就会自动结束

- 首先将服务设置为后台，有两种方法：

  - 对于运行中的进程，可以先按`ctrl + z`，然后执行`bg`命令
  - 对于未启动的进程，直接在命令后加&即可

- 一般来说设置为后台即可解决问题，但并不100%保险，可以在设置为后台进程后运行命令

  ```
  disown
  ```

  会将启动的进程移除后台进程队列，这样可以确保其不会在控制台退出后被结束

